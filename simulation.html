<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="base.css">
    <link rel="stylesheet" href="simulation.css">
    <title>Simulation</title>
</head>
<body>

<h1>Simulation</h1>

<nav>
    <a href="index.html">Back</a>
</nav>

<div class="encadre" id="budget-section">
    <h2>Budget</h2>
    <div class="budget-input">
        <span>What's your budget? </span>
        <input type="number" id="budget" oninput="filterBudget()">
        <span>€</span>
        <button onclick="validateBudget()">Validate budget</button>
    </div>
</div>

<div class="encadre" id="category-section">
    <h2>Now pick your style</h2>
    <div class="category-options" id="category-options"></div>
</div>

<div class="encadre" id="detail-section">
    <h2>Detail</h2>
    <div class="details-options" id="details-options"></div>
</div>

<div id="total-price"></div>

<h4 class="contact-text">
    If you're interested, you can contact me on
    <a href="https://www.tumblr.com/blog/noveltale" class="contact-link">Tumblr</a>
    or
    <a href="https://www.instagram.com/suteki_koneko_/" class="contact-link">Instagram</a>
</h4>

<script>
let prices = {};
let selectedCategory = null;
let selectedDetail = null;

fetch('prices.json')
    .then(resp => resp.json())
    .then(data => prices = data)
    .catch(err => console.error('Error loading JSON:', err));

function filterBudget() {
    const budgetValue = parseFloat(document.getElementById('budget').value);
    const budgetItems = Object.keys(prices);

    const categoryOptions = document.getElementById('category-options');
    categoryOptions.innerHTML = '';

    budgetItems.forEach(cat => {
        const minPrice = Math.min(...Object.values(prices[cat] || {}));
        if (budgetValue && budgetValue >= minPrice) {
            const div = document.createElement('div');
            div.classList.add('category-option');

            const img = document.createElement('img');
            img.src = `Commission_pictures/${cat}.png`;
            img.alt = cat;
            img.style.width = '100px';
            img.style.height = '100px';
            img.style.objectFit = 'cover';
            img.style.borderRadius = '8px';
            img.style.marginBottom = '5px';
            div.appendChild(img);

            const label = document.createElement('span');
            label.textContent = cat.charAt(0).toUpperCase() + cat.slice(1);
            div.appendChild(label);

            div.onclick = () => selectCategory(cat);
            categoryOptions.appendChild(div);
        }
    });

    categoryOptions.style.display = budgetValue && budgetValue > 0 ? 'flex' : 'none';
}

function validateBudget() {
    const budgetValue = parseFloat(document.getElementById('budget').value);
    if (budgetValue && budgetValue > 0) {
        document.getElementById('category-section')
            .scrollIntoView({ behavior: 'smooth', block: 'center' });
    }
}

function selectCategory(cat) {
    selectedCategory = cat;
    selectedDetail = null;

    const allOptions = document.querySelectorAll('.category-option');
    allOptions.forEach(o => {
        o.classList.toggle('selected', o.textContent.toLowerCase() === cat);
    });

    const detailsDiv = document.getElementById('details-options');
    detailsDiv.innerHTML = '';

    const budget = parseFloat(document.getElementById('budget').value);

    const detailOrder = ['head', 'bust', 'full'];

    detailOrder.forEach(part => {
        const cost = prices[cat][part];

        if (cost <= budget) {
            const div = document.createElement('div');
            div.classList.add('detail-item-circle');

            div.dataset.part = part;

            let displayText = part === 'bust' ? 'Chest'
                : part.charAt(0).toUpperCase() + part.slice(1);

            div.textContent = displayText;
            div.onclick = () => selectDetail(part);
            detailsDiv.appendChild(div);
        }
    });

    detailsDiv.style.display = 'flex';
    document.getElementById('total-price').style.display = 'none';

    document.getElementById('detail-section')
        .scrollIntoView({ behavior: 'smooth', block: 'center' });
}

function selectDetail(part) {
    selectedDetail = part;

    const allDetails = document.querySelectorAll('.detail-item-circle');
    allDetails.forEach(d => {
        d.classList.toggle('selected', d.dataset.part === part);
    });

    if (selectedCategory && selectedDetail) {
        const price = prices[selectedCategory][selectedDetail];
        const totalDiv = document.getElementById('total-price');
        totalDiv.textContent = `This commission would cost ${price} €`;
        totalDiv.style.display = 'block';

        totalDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }
}
</script>

</body>
</html>
